# azure-custom-role-generator
This is a command line tool generating a template of Azure Custom Role definition from Azure REST API's endpoint and HTTP method in the Azure CLI `az`.

> **_NOTE:_** The actions in the generated definition by this command are based on logs of which the `az` command requests to Azure Resource Manager directly. So, the actions might not be enough to execute the same operation on **Azure portal**.

---

# Usage

If you want to create a definition from scratch, no options and flags for `custom-role-generator` are needed.  
Basicaly this command extracts Azure REST API's endpoint and HTTP method from access logs of `az`, so `--debug` option for outputting the logs to stderr and redirection of stderr to stdout for `az` are needed.

```console
$ az [subcommand, arguments, and options] --debug 2>&1 | custom-role-generator
{
  "AssignableScopes": [
    "/subscriptions/..."
  ],
  "actions": [
    "Some.Provider/.../..."
  ],
  "dataActions": [],
  "description": "Generated by custom-role-generator",
  "isCustom": true,
  "name": "<REPLACE_THIS>",
  "notActions": [],
  "notDataActions": []
}
```

If you already have a definition JSON file, `--append-to` options appends actions from `az` to the definition JSON file.

```console
$ cat /path/to/existing_role_definition.json
{
  "AssignableScopes": [
    "/subscriptions/..."
  ],
  "actions": [
    "Some.Provider/.../...",
      :
  ],
  "dataActions": [],
  "description": "Generated by custom-role-generator",
  "isCustom": true,
  "name": "<REPLACE_THIS>",
  "notActions": [],
  "notDataActions": []
}

$ az [subcommand, arguments, and options] --debug 2>&1 | custom-role-generator --append-to /path/to/existing_role_definition.json
{
  "AssignableScopes": [
    "/subscriptions/..."
  ],
  "actions": [
    "Some.Provider/.../...",
    "Some.Provider2/appended/action1",
    "Some.Provider2/appended/action1",
      :
  ],
  "dataActions": [],
  "description": "Generated by custom-role-generator",
  "isCustom": true,
  "name": "<REPLACE_THIS>",
  "notActions": [],
  "notDataActions": []
}
```

The `custom-role-generator` processes debug logs of `az`, so the logs aren't shown by default.  
If you want to output the logs of `az`, add `--debug` options of `custom-role-generator`.

```console
$ az [subcommand, arguments, and options] --debug 2>&1 | custom-role-generator --debug
cli.knack.cli: Command arguments: ['[subcommand]', 'arguments'...]
cli.knack.cli: __init__ debug log:
Cannot enable color.
cli.knack.cli: Event: Cli.PreExecute []
  :

{
  "AssignableScopes": [
    "/subscriptions/..."
  ],
  "actions": [
    "Some.Provider/.../...",
      :
  ],
  "dataActions": [],
  "description": "Generated by custom-role-generator",
  "isCustom": true,
  "name": "<REPLACE_THIS>",
  "notActions": [],
  "notDataActions": []
}
```

